<!DOCTYPE html>
<html lang="en-US">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="icon" href="Images/al-favicon.png">
<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta content="utf-8" http-equiv="encoding">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.11.3/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.11.3/datatables.min.js"></script>
	<script type="text/javascript" src="js/script.js"></script>
	<style>
		.table td, .table th {vertical-align: middle!important;}
		.blue, .Rare {background-color: powderblue;}
		.purple, .Elite {background-color: plum;}
		.gold, .Super {background-color: palegoldenrod;}
        .rainbow, .Ultra {background: linear-gradient(120deg,#fbffca,#baffbf,#a7efff,#ffabff)!important;}
        .banner {padding: 0!important;}
        .banner img {height: 55px;}
	</style>
	<title>Effective Hit Points</title>
</head>
<body>
    <table class="table table-hover align-middle text-center" id="mainTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Ship</th>
                <th>Type</th>
                <th>HP</th>
                <th>Evasion</th>
                <th>Luck</th>
                <th>Base eHP</th>
            </tr>
        </thead>
        <tbody class="shipList"></tbody>
    </table>
</body>
<script>
let vanguard = []; 
let backline = [];
let AzurAPI = [];
    fetch("https://raw.githubusercontent.com/AzurAPI/azurapi-js-setup/master/ships.json")
    .then(res => res.json())
    .then(
        (azurAPI) => {
            AzurAPI = azurAPI;
            console.log("AzurAPI Loaded!");
            console.log("Type %cAzurAPI" + " %cto show in console", "color:yellow", "color:white");
            dataExtractor(azurAPI);
        },
        (error) => {
            console.log('error: ' + error);
        }
    );
// variable space
let shipList = "";

// function space
function vanguardFilter(azurAPI) {
    azurAPI.forEach((ship) => {
        if(
            ship.hullType === "Destroyer" ||
            ship.hullType === "Light Cruiser" ||
            ship.hullType === "Heavy Cruiser" ||
            ship.hullType === "Large Cruiser" ||
            ship.hullType === "Munition Ship"
        ) {vanguard.push(ship)} else {backline.push(ship)};
    })
}
// ehp calculate 
// 1. calculate { attackerAccuracy = AttackerHit / (AttackerHit + DefenderEvasion + 2) }
// 2. calculate { attackerChance = (AttackerLuck - DefenderLuck + LevelDifference) / 1000 }
// calculate { accuracy = 0.1 + attackerAccuracy +  attackerChance + AccuracyVsShipTypeSkill - Evasion Rate Skill }
// calculate { eHP = baseHP / accuracy }
function eHPCalculate(health, evasion, luck, attackerHit, attackerLuck, levelDifference, accuracySkill, evarate) {
    const baseHP            = parseInt(health);
    const defenderEvasion   = parseInt(evasion);
    const defenderLuck      = parseInt(luck);
    const attackerAccuracy  = attackerHit / (attackerHit + defenderEvasion + 2);
    const attackerChance    = ((attackerLuck - defenderLuck) + levelDifference) / 1000;
    const accuracy          = 0.1 + attackerAccuracy + attackerChance + (accuracySkill - evarate);
    const eHP               = health / accuracy;
    return eHP.toFixed(0);
}

function shipCreate(azurAPI) {
    azurAPI.forEach((ship) => {
        const id                = ship.id;
        const name              = ship.names.en;
        const type              = ship.hullType;
        const health            = ship.stats.level125.health;
        const evasion           = ship.stats.level125.evasion;
        const luck              = ship.stats.level125.luck;
        const enemyLevel        = 125;
        const attackerHit       = 75;
        const attackerLuck      = 25;
        const levelDifference   = 125 - enemyLevel;
        const accuracySkill     = 0;
        const evarate           = 0;
        const eHP               = eHPCalculate(health, evasion, luck, attackerHit, attackerLuck, levelDifference, accuracySkill, evarate);
        if(ship.names.en === "22") {
            console.log(name)
            console.log(type)
            console.log(health)
            console.log(evasion)
            console.log(luck)
            console.log(enemyLevel)
            console.log(attackerHit)
            console.log(attackerLuck)
            console.log(levelDifference)
            console.log(accuracySkill)
            console.log(evarate)
            console.log(eHP)
        }
        const notes             = "blank";
        shipList += `
            <tr>
                <th>${id}</th>
                <th>${name}</th>
                <th>${type}</th>
                <th>${health}</th>
                <th>${evasion}</th>
                <th>${luck}</th>
                <th>${eHP}</th>
            </tr>
        `;
    })
    $(".shipList").html(shipList)
    $("#mainTable").dataTable({searching: false, paging: false, info: false});
}
function dataExtractor(azurAPI) {
    vanguardFilter(azurAPI);
    shipCreate(vanguard);
}
$(function () {$('[data-toggle="tooltip"]').tooltip()})
</script>
</html>