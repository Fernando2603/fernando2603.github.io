<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<style>
			body {background: black; color: white;}
			ul, li {list-style-type: none; margin-top: 0px; margin-bottom: 0px;}
			.filled {color: white;}
			.unfilled {color: #c00000; background-color: #faa;}
			pre {margin-top: 0px; margin-bottom: 0px;}
			.missingBorder {background-color: blueviolet;}
			.missingSkin {text-align: center; vertical-align: center; background-color: #faa; color: #c00000; font-weight: bolder;}
			.unknownBanner {color: darkorange;}
			.missingBorder .filled {background-color: #c6efce; color: #006100;}
			.missingBorder > .count::before {background-color: darkviolet; color: white;}
			.missingBorder > .unknownBanner {background-color: antiquewhite!important; color: #9c6500!important;}
			pre.code {
			  white-space: pre-wrap;
			}
			body {
			  counter-reset: listing;
			  margin: 0px;
			}
			.count {
			  counter-increment: listing;
			}
			.count::before {
			  content: counter(listing) ". ";
			  display: inline-block;
			  background-color: dimgray;
			  width: 50px;         /* now works */
			  padding-left: auto; /* now works */
			  margin-left: auto;  /* now works */
			  text-align: right;  /* now works */
			}
			pre {
			white-space: normal;
			}
			span {
			white-space: pre-wrap;
			}
			.unknownBanner .count::before {
				background-color: #ffc017!important;
				color: black!important;
			}
			.unfilled .count::before {
				background-color: #dc3545!important;
				color: black!important;
			}
			.missingBorder .filled .count::before {
				background-color: springgreen;
				color: black;
			}
		</style>
	</head>
	<body>
		<div class="missingSkin"></div>
		<div>
			<pre class="code"><code class="count">[</code></pre>
			<pre class="demo code"></pre>
			<pre class="code"><code class="count">]</code></pre>
		</div>
	</body>
	<script>
		let AzurAPI = [];
		let ShipBanner = [];
		Promise.all([
			fetch("https://raw.githubusercontent.com/AzurAPI/azurapi-js-setup/master/ships.json")
			.then(res => res.json()),
			fetch("https://raw.githubusercontent.com/Fernando2603/AzurLane/main/ShipBanner.json")
			.then(res => res.json())
		]).then(
			([azurAPI, shipBanner]) => {
				AzurAPI = azurAPI;
				console.log("AzurAPI & ShipBanner Loaded!")
				ShipBanner = shipBanner;
				console.log("Type %cAzurAPI" + " %cor " + "%cShipBanner" + " %cto show in console", "color:yellow", "color:white", "color:yellow", "color:white")
				dataExtractor(azurAPI, shipBanner);
		    },
		    (error) => {
		    	console.log('error: ' + error);
		    }
	    );

		// ShipBanner Extractor
		let teste = "";
		let count = 0;
		let missingArray = [];
		let unknownArray = [];
		function showMissing() {missingArray.forEach((alert) => console.log("%cAlert " + alert + " skin banner is missing!", "color: #faa"))}
		function showUnknown() {unknownArray.forEach((alert) => console.log("%cWarn " + alert + " skin banner is unknown!", "color: orange"))}

		function dataExtractor(azurAPI, banner) {
			azurAPI.forEach((ship) => {
				let skins = "";
				let parentFill = false;
				let bannerid = 0;
				let parentSparator = ",";
				for(var i = 0; i < banner.length; i++) {
					if(banner[i].id == ship.id) {
						bannerid = banner[i];
					}
				}
				console.log("of " + azurAPI.length + " %c#Rendered", "color:yellow");
				ship.skins.forEach((skin) => {
					let skinbanner = "https://raw.githubusercontent.com/Fernando2603/AzurLane/main/images/skins/";
					let bannerStatus = true;
					let unknownStatus = false;
					let lastSparator = ","
					if(bannerid.skins !== undefined) {
						for(var i = 0; i < bannerid.skins.length; i++) {
							if(bannerid.skins[i].name === skin.name) {
								skinbanner = bannerid.skins[i].banner;
								bannerStatus = false;
								if(skinbanner === "https://raw.githubusercontent.com/Fernando2603/AzurLane/main/images/skins/Unknown/UnknownBanner.png") {
									unknownArray.push(ship.names.en);
									unknownStatus = true;
								}
								var currentLength = i + 1;
								if(ship.skins.length == currentLength) {lastSparator = ""};
							}
						}
					}
					if(bannerStatus) {lastSparator = ""};
					let unknownClass = "";
					if(unknownStatus) {unknownClass = " unknownBanner"}
					let bannerClass = `class=\"filled${unknownClass}\"`;
					if(bannerStatus) {bannerClass = `class=\"unfilled\"`; parentFill = true;}
// pre alignment weird
skins += `
<span ${bannerClass}><code class="count">         {</code>
<code class="count">            \"name\":\"${skin.name.replace(/\"/g,"\\\"")}\",</code>
<code class="count">            \"banner\":\"${skinbanner}\"</code>
<code class="count">         }${lastSparator}</code></span>`
				}) // forEach Separator in line 87;


				let missingBorder = "";
				if(parentFill) {
					missingArray.push(ship.names.en);
					missingBorder = "class=\"missingBorder\"";
				}
				var parentLength = azurAPI.length - 1;

if(ship.id == azurAPI[parentLength].id) {parentSparator = ""}
teste += `<span ${missingBorder}><code class="count">   {</code>
<code class="count">      \"id\":\"${ship.id}\",</code>
<code class="count">      \"names\":\"${ship.names.en}\",</code>
<code class="count">      \"skins\":[</code>${skins}
<code class="count">      ]</code>
<code class="count">   }${parentSparator}</code>
</span>`	

   				count++;
   				if(count === azurAPI.length) {
   					console.log("%cCompleted!","color: limegreen;")
   					if(missingArray.length > 0) {
   						$(".missingSkin").append("Alert<br>" + missingArray + " skin is missing!");
   						console.warn("Missing Banner : " + missingArray.length)
   						console.log("type %c\"showMissing() %cor %cmissingArray\" %cto show the list", "color:yellow", "color:white", "color:yellow", "color:white")
   					} else {console.log ("%cNo missing banner!","color: limegreen;")}

   					if(unknownArray.length > 0) {
   						console.warn("Unknown Banner : " + unknownArray.length)
   						console.log("type %c\"showUnknown()\" %cor \"%cunknownArray\" %cto show the list", "color:yellow", "color:white", "color:yellow", "color:white")
   					} else {console.log("%cNo unknown banner!","color: limegreen;")}
   				}
   				if(count > 516) {
   					$(".demo").html(teste);
   				}
			})
		}
	</script>
</html>
